<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><link rel=preload as=font href=https://pollen-robotics.github.io/reachy-2021-docs/fonts/vendor/jost/jost-v4-latin-regular.woff2 type=font/woff2 crossorigin><link rel=preload as=font href=https://pollen-robotics.github.io/reachy-2021-docs/fonts/vendor/jost/jost-v4-latin-700.woff2 type=font/woff2 crossorigin><link rel=stylesheet href=https://pollen-robotics.github.io/reachy-2021-docs/main.c0e952e8144cca7526ee90f817f2c188a9e43e7fe99d8ad61502f745ff494977a3f5630a0455ef98b1942edc23007622f89657a1032b237af7cefc54a082f461.css integrity="sha512-wOlS6BRMynUm7pD4F/LBiKnkPn/pnYrWFQL3Rf9JSXej9WMKBFXvmLGULtwjAHYi+JZXoQMrI3r3zvxUoIL0YQ==" crossorigin=anonymous><noscript><style>img.lazyload{display:none}</style></noscript><meta name=robots content="index, follow"><meta name=googlebot content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1"><meta name=bingbot content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1"><title>Moving the mobile base - Reachy 2021</title><meta name=description content="Presentation of the different functions available to make the mobile base move"><link rel=canonical href=https://pollen-robotics.github.io/reachy-2021-docs/sdk/mobile-base/moving-the-base/><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://pollen-robotics.github.io/reachy-2021-docs/favicon.ico"><meta name=twitter:title content="Moving the mobile base"><meta name=twitter:description content="Presentation of the different functions available to make the mobile base move"><meta name=twitter:site content="@pollenrobotics"><meta name=twitter:creator content="@pollenrobotics"><meta property="og:title" content="Moving the mobile base"><meta property="og:description" content="Presentation of the different functions available to make the mobile base move"><meta property="og:type" content="article"><meta property="og:url" content="https://pollen-robotics.github.io/reachy-2021-docs/sdk/mobile-base/moving-the-base/"><meta property="og:image" content="https://pollen-robotics.github.io/reachy-2021-docs/favicon.ico"><meta property="article:published_time" content="2021-03-30T09:54:59+02:00"><meta property="article:modified_time" content="2021-03-30T09:54:59+02:00"><meta property="og:site_name" content="Reachy 2021"><meta property="article:publisher" content="https://www.facebook.com/pollenrobotics"><meta property="article:author" content="https://www.facebook.com/pollenrobotics"><meta property="og:locale" content="en_US"><script type=application/ld+json>{"@context":"http://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Home","item":"https:\/\/pollen-robotics.github.io\/reachy-2021-docs\/"},{"@type":"ListItem","position":2,"name":"Sdk","item":"https:\/\/pollen-robotics.github.io\/reachy-2021-docs\/sdk\/"},{"@type":"ListItem","position":3,"name":"Mobile Base","item":"https:\/\/pollen-robotics.github.io\/reachy-2021-docs\/sdk\/mobile-base\/"},{"@type":"ListItem","position":4,"name":"Moving the Base","item":"https:\/\/pollen-robotics.github.io\/reachy-2021-docs\/sdk\/mobile-base\/moving-the-base\/"}]}</script><meta name=theme-color content="#fff"><link rel=apple-touch-icon sizes=180x180 href=https://pollen-robotics.github.io/reachy-2021-docs/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=https://pollen-robotics.github.io/reachy-2021-docs/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=https://pollen-robotics.github.io/reachy-2021-docs/favicon-16x16.png><link rel=manifest href=https://pollen-robotics.github.io/reachy-2021-docs/site.webmanifest><script async src="https://www.googletagmanager.com/gtag/js?id=G-2EK4TRNC7L"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-2EK4TRNC7L')</script></head><body class="SDK single"><div class="header-bar fixed-top"></div><header class="navbar fixed-top navbar-expand-md navbar-light"><div class=container><input class="menu-btn order-0" type=checkbox id=menu-btn>
<label class="menu-icon d-md-none" for=menu-btn><span class=navicon></span></label><a class="navbar-brand order-1 order-md-0 me-auto" href=https://pollen-robotics.github.io/reachy-2021-docs/>Reachy 2021</a>
<button id=mode class="btn btn-link order-2 order-md-4" type=button aria-label="Toggle mode">
<span class=toggle-dark><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-moon"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg></span><span class=toggle-light><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-sun"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></span></button><ul class="navbar-nav social-nav order-3 order-md-5"><li class=nav-item><a class=nav-link href=https://twitter.com/pollenrobotics><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-twitter"><path d="M23 3a10.9 10.9.0 01-3.14 1.53 4.48 4.48.0 00-7.86 3v1A10.66 10.66.0 013 4s-4 9 5 13a11.64 11.64.0 01-7 2c9 5 20 0 20-11.5a4.5 4.5.0 00-.08-.83A7.72 7.72.0 0023 3z"/></svg><span class="ms-2 visually-hidden">Twitter</span></a></li><li class=nav-item><a class=nav-link href=https://github.com/pollen-robotics/><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-github"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg><span class="ms-2 visually-hidden">GitHub</span></a></li></ul><div class="collapse navbar-collapse order-4 order-md-1"><ul class="navbar-nav main-nav me-auto order-5 order-md-2" style=width:75%><li class=nav-item><a class=nav-link href=https://pollen-robotics.github.io/reachy-2021-docs/advanced/overview/full-kit>Description</a></li><li class=nav-item><a class=nav-link href=https://pollen-robotics.github.io/reachy-2021-docs/docs/installation/full-installation-process/>Setup Reachy</a></li><li class=nav-item><a class=nav-link href=https://pollen-robotics.github.io/reachy-2021-docs/sdk/getting-started/introduction/>Python SDK</a></li><li class=nav-item><a class=nav-link href=https://pollen-robotics.github.io/reachy-2021-docs/vr/introduction/introduction>VR</a></li><li class=nav-item><a class=nav-link href=https://pollen-robotics.github.io/reachy-2021-docs/dashboard/introduction/introduction>Dashboard</a></li><li class=nav-item><a class=nav-link href=https://pollen-robotics.github.io/reachy-2021-docs/help/check-dashboard>Help</a></li></ul><form class="navbar-form flex-grow-1 order-7 order-md-3" style=width:25%;margin-left:0><input id=userinput class="form-control is-search" type=search placeholder="Search docs..." aria-label="Search docs..." autocomplete=off><div id=suggestions class="shadow bg-white rounded"></div></form></div></div></header><div class="wrap container" role=document><div class=content><div class="row flex-xl-nowrap"><div class="col-lg-5 col-xl-4 docs-sidebar"><nav class=docs-links aria-label="Main navigation"><h3>Getting Started</h3><ul class=list-unstyled><li><a class=docs-link href=https://pollen-robotics.github.io/reachy-2021-docs/sdk/getting-started/introduction/>Introduction</a></li><li><a class=docs-link href=https://pollen-robotics.github.io/reachy-2021-docs/sdk/getting-started/install/>Installation</a></li><li><a class=docs-link href=https://pollen-robotics.github.io/reachy-2021-docs/sdk/getting-started/finding-ip/>Finding Reachy's IP</a></li></ul><h3>First moves</h3><ul class=list-unstyled><li><a class=docs-link href=https://pollen-robotics.github.io/reachy-2021-docs/sdk/first-moves/intro/>Once you're connected</a></li><li><a class=docs-link href=https://pollen-robotics.github.io/reachy-2021-docs/sdk/first-moves/safety/>Safety first</a></li><li><a class=docs-link href=https://pollen-robotics.github.io/reachy-2021-docs/sdk/first-moves/kinematics/>Arms kinematics</a></li><li><a class=docs-link href=https://pollen-robotics.github.io/reachy-2021-docs/sdk/first-moves/arm/>Controlling the arm</a></li><li><a class=docs-link href=https://pollen-robotics.github.io/reachy-2021-docs/sdk/first-moves/record/>Record and play trajectories</a></li><li><a class=docs-link href=https://pollen-robotics.github.io/reachy-2021-docs/sdk/first-moves/head/>Controlling the head</a></li><li><a class=docs-link href=https://pollen-robotics.github.io/reachy-2021-docs/sdk/first-moves/cameras/>Reachy's cameras</a></li><li><a class=docs-link href=https://pollen-robotics.github.io/reachy-2021-docs/sdk/first-moves/fans/>Controlling the fans</a></li></ul><h3>Mobile base</h3><ul class=list-unstyled><li><a class=docs-link href=https://pollen-robotics.github.io/reachy-2021-docs/sdk/mobile-base/getting-started/>Getting started with the mobile base</a></li><li><a class="docs-link active" href=https://pollen-robotics.github.io/reachy-2021-docs/sdk/mobile-base/moving-the-base/>Moving the mobile base</a></li><li><a class=docs-link href=https://pollen-robotics.github.io/reachy-2021-docs/sdk/mobile-base/drive-control-modes/>Advanced</a></li><li><a class=docs-link href=https://pollen-robotics.github.io/reachy-2021-docs/sdk/mobile-base/safety/>Anti-collision safety</a></li><li><a class=docs-link href=https://pollen-robotics.github.io/reachy-2021-docs/sdk/mobile-base/mobile-base-alone/>Using the mobile base without Reachy</a></li></ul><h3>Application</h3><ul class=list-unstyled><li><a class=docs-link href=https://pollen-robotics.github.io/reachy-2021-docs/sdk/application/hello-world/>Hello World</a></li><li><a class=docs-link href=https://pollen-robotics.github.io/reachy-2021-docs/sdk/application/face-tracking/>Face Tracking</a></li></ul><h3>appendix</h3><ul class=list-unstyled><li><a class=docs-link href=https://pollen-robotics.github.io/reachy-2021-docs/sdk/appendix/apis/>APIs</a></li><li><a class=docs-link href=https://pollen-robotics.github.io/reachy-2021-docs/sdk/appendix/support/>Support</a></li></ul></nav></div><nav class="docs-toc d-none d-xl-block col-xl-3" aria-label="Secondary navigation"><div class=page-links><h3>On this page</h3><nav id=TableOfContents><ul><li><a href=#frame-conventions>Frame conventions</a><ul><li><a href=#rep-105-coordinate-frames-for-mobile-platforms>REP 105 “Coordinate Frames for Mobile Platforms”</a></li><li><a href=#robot-frame>Robot frame</a></li><li><a href=#odom-frame>Odom frame</a></li></ul></li><li><a href=#moving-the-mobile-base>Moving the mobile base</a><ul><li><a href=#using-the-set_speed-method>Using the set_speed method</a></li><li><a href=#using-the-goto-method>Using the goto method</a></li></ul></li></ul></nav></div></nav><main class="docs-content col-lg-11 col-xl-9"><h1>Moving the mobile base</h1><p class=lead></p><h2 id=frame-conventions>Frame conventions<a href=#frame-conventions class=anchor aria-hidden=true>#</a></h2><h3 id=rep-105-coordinate-frames-for-mobile-platforms>REP 105 “Coordinate Frames for Mobile Platforms”<a href=#rep-105-coordinate-frames-for-mobile-platforms class=anchor aria-hidden=true>#</a></h3><p>Our design is coherent with ROS' conventions described in <a href=https://www.ros.org/reps/rep-0105.html>REP 105 “Coordinate Frames for Mobile Platforms”</a></p><h3 id=robot-frame>Robot frame<a href=#robot-frame class=anchor aria-hidden=true>#</a></h3><p>The robot frame or egocentric frame or base_link frame is <strong>rigidly attached to the robot</strong>. Its (0, 0) point is the projection on the floor of the center of the mobile base.
<strong>X in front, Y to the left, Theta positive counterclockwise.</strong></p><p align=center><img src=robot_frame.png alt=robot_frame width=60%></p><h3 id=odom-frame>Odom frame<a href=#odom-frame class=anchor aria-hidden=true>#</a></h3><p>The odom frame is a <strong>world-fixed frame</strong>. The position (x, y, theta) of the robot in the odom frame is continuously updated by the HAL through odometry calculations. These calculations currently only use the measurements from the wheels to estimate the movement of the robot. While the position of the robot is continuous, <strong>it should never be relied upon for long-term reference as it will always drift.</strong></p><p align=center><img src=odom_frame.png alt=odom_frame width=60%></p><p>The initial position of the odom frame matches the position of the robot when the HAL was started. The odom frame can also be reset to the current position of the robot using:</p><pre><code class=language-python>reachy.mobile.reset_odometry()
</code></pre><h2 id=moving-the-mobile-base>Moving the mobile base<a href=#moving-the-mobile-base class=anchor aria-hidden=true>#</a></h2><p>There are two interfaces in the SDK to control the mobile base: spamming speed commands or setting a goal position in the odom frame.</p><h3 id=using-the-set_speed-method>Using the set_speed method<a href=#using-the-set_speed-method class=anchor aria-hidden=true>#</a></h3><p>Since the mobile base is holonomic, the set_speed method expects 3 speed commands expressed in the robot frame:</p><ul><li>x_vel, in m/s. The instantaneous speed positive in front of the robot.</li><li>y_vel, in m/s. The instantaneous speed positive to the left of the robot.</li><li>rot_vel, in deg/s. The instantaneous rotational speed positive counterclockwise.</li></ul><p>See the <a href=https://github.com/pollen-robotics/mobile-base-sdk/blob/main/mobile_base_sdk/examples/scripts/joy_controller.py>joy_controller code</a> for a working example.</p><p>💡 As a safety measure, the HAL will stop the wheels if it didn&rsquo;t receive a new goal speed in the last 200ms.</p><p>💡 The way this is implemented in the HAL is simply to listen to the /cmd_vel topic, apply some smoothing, perform the kinematic calculations and send the speed commands to the wheels. This makes it very easy to create control interfaces using ROS, see the <a href=https://github.com/pollen-robotics/zuuu_hal/blob/main/examples/zuuu_teleop_keyboard.py>keyboard example</a> or the <a href=https://github.com/pollen-robotics/zuuu_hal/blob/main/examples/zuuu_teleop_joy.py>joy controller example</a>.</p><p><em>Note: the HAL has a drive mode to set speed commands for variable amounts of time. Instead of relying on a topic, it creates a service. The niche usage didn&rsquo;t warrant the added complexity, so the interface with the SDK was not made. But if needed, it exists!</em></p><h3 id=using-the-goto-method>Using the goto method<a href=#using-the-goto-method class=anchor aria-hidden=true>#</a></h3><p>The goto method expects a goal position in the odom frame, composed of 3 elements: x in m, y in m and theta in deg.</p><p>⚠️ The most important thing to get used to, is the fact that the odom frame is world-fixed and that the position of the robot is always updated as long as the HAL is running (the HAL is automatically started during the robot boot-up). So by default, <strong>if you ask for a <code>goto(0, 0, 0)</code> the robot will try to comeback to the position it was at boot-up.</strong></p><p>To perform a goto relative to the current position of the robot, use the method <code>reset_odometry()</code>. For example, create an instance of reachy with:</p><pre><code class=language-python>from reachy_sdk import ReachySDK

reachy_mobile = ReachySDK(host='your-reachy-ip', with_mobile_base=True)
</code></pre><p>Reset the odometry frame, and ask the robot to move 50cm in front of it:</p><pre><code class=language-python>reachy_mobile.mobile_base.reset_odometry()
reachy_mobile.mobile_base.goto(x=0.5, y=0.0, theta=0.0)
</code></pre><p>Now, ask for a goto(0,0,0). The robot should go back to its previous position:</p><pre><code class=language-python>reachy_mobile.mobile_base.goto(x=0.0, y=0.0, theta=0.0)
</code></pre><p><strong>We recommend taking the time to play around with this concept.</strong> You can use <a href=https://github.com/pollen-robotics/mobile-base-sdk/blob/main/mobile_base_sdk/examples/notebooks/goto.ipynb>this Jupyer notebook to explore the goto method.</a></p><p>By default, the robot will always try to reach the goal position, meaning that even if the robot did reach its position and you push it, it will try to come back to the the goal position again.</p><p>However, you can define two types of stop conditions through optional parameters (see the above Jupyter notebook for a working example).</p><ul><li>A timeout, expressed in seconds. The robot stops the goto when the elapsed time since the start of the command is superior to the timeout. There is a <strong>default timeout that scales with the distance asked by the goto</strong>.</li><li>A spatial tolerance, expressed with 4 values: delta_x (the error in m along the X axis), delta_y (the error in m along the Y axis), delta_theta (the angle error in deg) and distance (the l2 distance between the current position and the goal position in m). The robot stops the goto when it is close enough to satisfy all 4 conditions simultaneously.
explored in :</li></ul><p>💡 <em>Note: the goto behaviour is implemented in the HAL using 3 independent PIDs, one to reduce delta_x, one for delta_y and one for delta_theta. The PIDs can&rsquo;t be tuned at the SDK level, but they can at the HAL level.</em></p><p class=edit-page><a href=https://github.com/pollen-robotics/reachy-2021-docs/blob/master/content/SDK/mobile-base/moving-the-base/index.md><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-edit-2"><path d="M17 3a2.828 2.828.0 114 4L7.5 20.5 2 22l1.5-5.5L17 3z"/></svg>Edit this page on GitHub</a></p><div class="docs-navigation d-flex justify-content-between"><a href=https://pollen-robotics.github.io/reachy-2021-docs/sdk/mobile-base/getting-started/><div class="card my-1"><div class="card-body py-2">&larr; Getting started with the mobile base</div></div></a><a class=ms-auto href=https://pollen-robotics.github.io/reachy-2021-docs/sdk/mobile-base/drive-control-modes/><div class="card my-1"><div class="card-body py-2">Advanced &rarr;</div></div></a></div></main></div></div></div><footer class="footer text-muted"><div class=container><div class=row><div class="col-lg-8 order-last order-lg-first"><ul class=list-inline><li class=list-inline-item>Powered by <a href=https://gohugo.io/>Hugo</a>, and <a href=https://getdoks.org/>Doks</a></li></ul></div><div class="col-lg-8 order-first order-lg-last text-lg-end"><ul class=list-inline></ul></div></div></div></footer></div><script type=text/javascript src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><script src=https://pollen-robotics.github.io/reachy-2021-docs/js/bootstrap.min.2374eee79bc19379a4404a900e042aef91675978a6686beeb97b3b0fa80af5c349abc1304de36298d942cde796148b853299ff49801257ee2b89e89ac427d75b.js integrity="sha512-I3Tu55vBk3mkQEqQDgQq75FnWXimaGvuuXs7D6gK9cNJq8EwTeNimNlCzeeWFIuFMpn/SYASV+4rieiaxCfXWw==" crossorigin=anonymous defer></script><script src=https://pollen-robotics.github.io/reachy-2021-docs/js/highlight.min.7f5bf68b5bfc062d7e707000983ea05fd4de1b88dc3d1ab93cd3ac70ec6c3dba95a619ffec97e2fc2805b276f80bf0891648ec18320c55666298a293cb014739.js integrity="sha512-f1v2i1v8Bi1+cHAAmD6gX9TeG4jcPRq5PNOscOxsPbqVphn/7Jfi/CgFsnb4C/CJFkjsGDIMVWZimKKTywFHOQ==" crossorigin=anonymous defer></script><script src=https://pollen-robotics.github.io/reachy-2021-docs/main.min.7ab523108435955765bcb88a0ee704f412ba01646b5478e84f3b9feb24f0ce750a14c3f7bd9a62408fe21e41996d361a9eb29f77e85dfe77b7e17f7623bd3a97.js integrity="sha512-erUjEIQ1lVdlvLiKDucE9BK6AWRrVHjoTzuf6yTwznUKFMP3vZpiQI/iHkGZbTYanrKfd+hd/ne34X92I706lw==" crossorigin=anonymous defer></script><script src=https://pollen-robotics.github.io/reachy-2021-docs/index.min.a00bd9d68beea62184e2b6ff8cd64131de45bfd433e1b6ce713aafaa9ffc63ab69a1ed6c94766e51d1a8e088a58796538290558a552cd143e6bd929645563b9f.js integrity="sha512-oAvZ1ovupiGE4rb/jNZBMd5Fv9Qz4bbOcTqvqp/8Y6tpoe1slHZuUdGo4Iilh5ZTgpBVilUs0UPmvZKWRVY7nw==" crossorigin=anonymous defer></script></body></html>